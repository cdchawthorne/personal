alias ls='ls --color=auto --group-directories-first'

alias grep='grep --colour=auto'
alias ip='ip -c'

alias ll='ls -Al'
alias la='ls -A'
alias lr='ls -lrt'
alias liesl='ls'
alias l='ls'
alias s='ls'
alias sl='ls'

function cd {
    builtin cd $@ && ls
}
alias d='cd'
alias c='cd'
alias dc='cd'

alias gl='git log --branches --oneline --graph'
alias gls='git log --oneline --graph --first-parent'
alias gs='git status'
alias gd='git difftool --extcmd nvim-rdiff'
alias gds='git diff'
function gdc {
  git diff "$1~1" $1
}
alias g='cd $(git rev-parse --show-toplevel)'
alias r='cd ~/work/mediary-system'

alias rlwrap='rlwrap -s 1000000'
alias sudo='sudo '
alias xargs='xargs '
alias cck='cargo check'

function wping {
  while ! ping -c 1 -W 1 $1 &> /dev/null; do
    sleep 1
  done
}

function rustrun {
  if [[ $# -ne 1 ]]; then
    echo "usage: rustrun foo.rs"
  fi
  rustc $1 && ./${1%.rs}
}

function e {
  for filename in $@; do
    nvim --server $NVIM --remote "$(realpath --relative-base=$HOME $filename)"
  done
}
alias ez='e ~/.zsh_aliases'
alias sz='source ~/.zsh_aliases'
function ed {
    if [[ -n $NVIM ]]; then
        nvim --server $NVIM --remote-tab "$(realpath --relative-base=$HOME $1)"
        nvim --server $NVIM --remote-send ':diffthis<CR>'
        nvim --server $NVIM --remote-send ":vert diffsplit $(realpath --relative-base=$HOME $2)<CR>"
    else
        nvim -d $@
    fi
}

alias man='man -i'
alias less='less -i'

alias rh='rehash'
alias settime='sudo zsh -c ''ntpd -q; hwclock -w'''
alias gpg='DISPLAY= gpg'

function timestamp {
    date +'%Y%m%d-%H%M%S'
}

function pa {
    if [[ $# -eq 0 ]]; then
        num=1
    else
        num=$1
    fi

    dest=.
    for i in $(seq ${num}); do
        dest=${dest}/..
    done
    cd ${dest}
}

function to {
    cd "$(dirname $1)"
}

function x {
    if ! pgrep sway &> /dev/null; then
        builtin cd
        ssh-agent sway
    fi
}

function python {
    (
        export INPUTRC=${HOME}/.pyinputrc
        command python $@
    )
}

function umts {
  for i in ~/mnt/*; do
    fusermount -u $i
  done
}

function mts {
  umts &> /dev/null
  ping -c1 -W0.5 altair &> /dev/null && sshfs altair:/home/cdchawthorne ~/mnt/altair && echo altair
  ping -c1 -W0.5 antares &> /dev/null && sshfs antares:/home/cdchawthorne ~/mnt/antares && echo antares
  ping -c1 -W0.5 slate &> /dev/null && sshfs root@slate:/ ~/mnt/slate && echo slate
  ping -c1 -W0.5 b1300 &> /dev/null && sshfs root@b1300:/ ~/mnt/b1300 && echo b1300
}

function backup {
  restic -r sftp:zh4398@zh4398.rsync.net:altair backup \
    ~/documents ~/media ~/recreation \
    --exclude ~/media/music/ocremix
  scp ~/.passwords/passwords.kdbx zh4398@zh4398.rsync.net:
}

function slate_push {
  builtin cd ~/work/mediary-system
  make lucid_gw_slate_dev_pack
  ssh slate 'lxc-stop -k lucid-gw; rm -rf /srv/lxc/lucid-gw; tar -C /srv/lxc/ -xzvf -' < "$(ls -rt1 target/lucid-gw*slate*.tar.gz | tail -1)"
  scp ../slate-core-config.json slate:/srv/lxc/lucid-gw/rootfs/etc/core_config.json
}

function b1300_push {
  builtin cd ~/work/mediary-system
  make lucid_gw_b1300_dev_pack
  ssh b1300 'lxc-stop -k lucid-gw; rm -rf /srv/lxc/lucid-gw; tar -C /srv/lxc/ -xzvf -' < "$(ls -rt1 target/lucid-gw*b1300*.tar.gz | tail -1)"
  scp ../b1300-core-config.json b1300:/srv/lxc/lucid-gw/rootfs/etc/core_config.json
}

function veea_push {
  builtin cd ~/work/mediary-system

  make lucid_gw_vhc25_binaries lucid_gw_vhe09_binaries

  scp target/armv7-unknown-linux-musleabihf/release/mediary alasia:veea-container-32-bit/lucid-files/bin
  scp target/armv7-unknown-linux-musleabihf/release-small/vcc_shell_setup alasia:veea-container-32-bit/lucid-files/bin
  scp target/armv7-unknown-linux-musleabihf/release-small/init alasia:veea-container-32-bit/lucid-files/sbin

  scp target/aarch64-unknown-linux-musl/release/mediary alasia:veea-container-64-bit/lucid-files/bin
  scp target/aarch64-unknown-linux-musl/release-small/vcc_shell_setup alasia:veea-container-64-bit/lucid-files/bin
  scp target/aarch64-unknown-linux-musl/release-small/init alasia:veea-container-64-bit/lucid-files/sbin
}
